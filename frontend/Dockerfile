# ใช้ Node.js base image
FROM node:18-alpine

# กำหนดไดเรกทอรีทำงานเป็น /app
WORKDIR /app

# คัดลอกไฟล์ package.json
COPY package*.json ./

# ติดตั้ง dependencies
RUN npm install --legacy-peer-deps

# รับค่า ENV (สำคัญสำหรับ Next.js)
ARG NEXT_PUBLIC_LOYVERSE_CONNECT_BASE_URL
ARG NEXT_PUBLIC_INVENTORY_BASE_URL
ARG NEXT_PUBLIC_SUPPLIER_BASE_URL
ARG NEXT_PUBLIC_PURCHASE_ORDER_BASE_URL
ARG NEXT_PUBLIC_SALE_BASE_URL
ARG NEXT_PUBLIC_RECEIPT_BASE_URL

ENV NEXT_PUBLIC_LOYVERSE_CONNECT_BASE_URL=$NEXT_PUBLIC_LOYVERSE_CONNECT_BASE_URL
ENV NEXT_PUBLIC_INVENTORY_BASE_URL=$NEXT_PUBLIC_INVENTORY_BASE_URL
ENV NEXT_PUBLIC_SUPPLIER_BASE_URL=$NEXT_PUBLIC_SUPPLIER_BASE_URL
ENV NEXT_PUBLIC_PURCHASE_ORDER_BASE_URL=$NEXT_PUBLIC_PURCHASE_ORDER_BASE_URL
ENV NEXT_PUBLIC_SALE_BASE_URL=$NEXT_PUBLIC_SALE_BASE_URL
ENV NEXT_PUBLIC_RECEIPT_BASE_URL=$NEXT_PUBLIC_RECEIPT_BASE_URL

# คัดลอก source code ทั้งหมด
COPY . .

# Build Next.js (ใช้ env ตอนนี้)
RUN npm run build

# เปิดพอร์ต
EXPOSE 3000

# ใช้ production server
CMD ["npm", "start"]
# ใช้ development server
# CMD ["npm", "run", "dev"]